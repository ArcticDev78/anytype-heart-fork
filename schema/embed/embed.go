//+build ignore

package main

import (
	"io"
	"io/ioutil"
	"log"
	"os"
	"strings"
)

// Reads all .json files in the current folder
// and encodes them as strings literals in schemas.go
func main() {
	out, err := os.OpenFile("schemas.go", os.O_WRONLY, 0644)
	if err != nil {
		log.Fatal(err)
	}
	defer out.Close()

	out.Write([]byte(`package schema

// Code generated by go generate; DO NOT EDIT.
//go:generate go run embed/embed.go

const (
`))
	fs, _ := ioutil.ReadDir(".")
	for _, f := range fs {
		if strings.HasSuffix(f.Name(), ".json") {
			out.Write([]byte("\t" + capitalize(strings.TrimSuffix(f.Name(), ".json")) + " = `"))
			f, _ := os.Open(f.Name())
			io.Copy(out, f)
			out.Write([]byte("`\n"))
		}
	}
	out.Write([]byte(")\n"))
}

func capitalize(s string) string {
	if len(s) == 0 {
		return s
	}

	if len(s) == 1 {
		return strings.ToTitle(s[0:1])
	}

	return strings.ToTitle(s[0:1]) + s[1:]
}
